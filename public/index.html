<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <script src="https://unpkg.com/vue"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.14.1/lodash.min.js"></script>
  <link rel="icon" href="<%= BASE_URL %>favicon.ico">
  <title><%= htmlWebpackPlugin.options.title %></title>
</head>

<body>
  <h1>Lazy Sudoku</h1>
  <p>Keep hitting the shuffle button until you win.</p>
  <div>
    <div id="flip-list-demo" class="demo">
      <button v-on:click="shuffle">Shuffle</button>
      <transition-group name="flip-list" tag="p">
        <span v-for="item in items" v-bind:key="item" class="list-complete-item">
          {{ item }}
        </span>
      </transition-group>
    </div>
    <div id="sudoku-demo" class="demo">

      <button @click="shuffle">
        Shuffle
      </button>
      <button @click="start">start</button>
      <button @click="end">end</button>
      <button @click="reset">reset</button>
      <div class="draw-list">
        <span v-for="item in target"> {{item.number}} </span>
      </div>
      <transition-group name="cell" tag="div" class="container">
        <div v-for="cell in cells" :key="cell.id" class="cell">
          {{ cell.number }}
        </div>
      </transition-group>
    </div>
  </div>


  <script>
    var inputData = ["李志軒1", "李志軒2", "李志軒3", "李志軒4", "李志軒5", "李志軒6", "李志軒7", "李志軒8"
      , "李志軒9", "李志軒10", "李志軒11", "李志軒12", "李志軒13", "李志軒14", "李志軒15"];
    new Vue({
      el: '#flip-list-demo',
      data: {
        items: inputData
      },
      methods: {
        shuffle: function () {
          this.items = _.shuffle(this.items)
        }
      }
    });

    new Vue({
      el: "#sudoku-demo",
      data: {
        cells: Array.apply(null, { length: inputData.length }).map(function (_, index) {
          return {
            id: index,
            number: inputData[index]
          };
        }),

        target: [],//中獎名單
        index: -1,//當前隨機索引
        timer: null,//定義一個定時器
        value: '',//當前人員名
        status: true//當前抽獎狀態
      },

      mounted() {

        if (localStorage.getItem('initData') === "undefined") {
          alert()
          localStorage.setItem('initData', JSON.stringify(this.cells))
        } else {
          this.cells = JSON.parse(localStorage.getItem('initData'))
        }
        if (localStorage.getItem('drawList')) {
          this.target = JSON.parse(localStorage.getItem('drawList'))
        }
      },
      methods: {
        shuffle: function () {
          this.cells = _.shuffle(this.cells);
        },
        start() {
          if (this.status) {
            if (this.index != -1) {
              this.cells.splice(this.index, 1)
              localStorage.setItem('initData', JSON.stringify(this.cells))
            }
            this.shuffle()
            setTimeout(() => {
              this.recursive()
            }, 800)
            this.status = !this.status
          }
        },
        randomIndex: function () {
          this.index = Math.floor(Math.random() * this.cells.length)
          return this.index
        },
        remove: function () {
          this.cells.splice(this.randomIndex(), 1)
        },
        recursive() {
          clearTimeout(this.timer)
          this.timer = setTimeout(() => {
            this.value = this.cells[this.randomIndex()]
            this.recursive()
          }, 200)
        },
        end() {
          if (this.status) {
            return
          }
          clearTimeout(this.timer)
          this.index = this.randomIndex()
          this.value = this.cells[this.index]
          this.target.push(this.value)
          localStorage.setItem('drawList', JSON.stringify(this.target))
          this.status = !this.status
        }
      }
    });
  </script>
</body>

</html>

<style>
  .flip-list-move {
    transition: transform 1s;
  }

  .list-complete-item {
    transition: all 1s;
    display: inline-block;
    margin-right: 10px;
  }


  /**/
  .container {
    display: flex;
    flex-wrap: wrap;
    width: 650px;
    margin-top: 10px;
  }

  .cell {
    display: flex;
    justify-content: space-around;
    align-items: center;
    width: 120px;
    height: 120px;
    border: 1px solid #aaa;
    margin-right: -1px;
    margin-bottom: -1px;
  }

  .cell:nth-child(3n) {
    margin-right: 0;
  }

  .cell:nth-child(27n) {
    margin-bottom: 0;
  }

  .cell-move {
    transition: transform 1s;
  }
</style>